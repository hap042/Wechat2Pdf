services:
  # 后端服务
  backend:
    build: .
    container_name: wechat2pdf-backend
    restart: always
    ports:
      - "8000:8000"
    volumes:
      - ./output:/app/output
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    environment:
      - MAX_CONCURRENT_DOWNLOADS=5

  # 前端 + 反向代理服务
  nginx:
    image: nginx:alpine
    container_name: wechat2pdf-nginx
    restart: always
    ports:
      - "8080:80"  # 映射到宿主机 8080 端口，避免占用 80
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    volumes:
      - ./nginx-docker.conf:/etc/nginx/conf.d/default.conf
      # 将本地构建好的前端 dist 目录挂载到容器内
      # 注意：部署前请先在本地运行 `cd frontend && npm run build`
      - ./frontend/dist:/usr/share/nginx/html
    depends_on:
      - backend
